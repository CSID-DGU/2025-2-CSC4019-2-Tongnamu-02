{% extends 'base.html' %}
{% load static %}

{% block extra_css %}
    <link rel="stylesheet" href="{% static 'css/result.css' %}">
{% endblock %}

{% block title %}ìƒì„± ê²°ê³¼ - My Project{% endblock %}

{% block content %}
<div class="results-container">
    <div class="results-card">
        <div class="card-header">
            <h2>ì´ë¯¸ì§€ ìƒì„± ê²°ê³¼</h2>
        </div>
        
        <div class="content-wrapper">
            
            <div class="image-section">
                <div class="image-display-area">
                    {% if image_urls %}
                        <img src="{{ image_urls.0 }}" id="main-image" alt="ìƒì„±ëœ ë©”ì¸ ì´ë¯¸ì§€">
                    {% endif %}

                    {% if image_urls|length > 1 %}
                    <div class="thumbnail-overlay" id="thumbnail-container">
                        {% for url in image_urls %}
                            <div class="thumb-item {% if forloop.first %}active{% endif %}" 
                                 data-src="{{ url }}"> <img src="{{ url }}" alt="ì¸ë„¤ì¼">
                            </div>
                        {% endfor %}
                    </div>
                    {% endif %}
                </div>
            </div>

            <div class="text-section">
                <h3>ì¶”ì²œ ë¬¸êµ¬</h3>
                <div class="text-box">
                    {% if word_urls %}
                        {% for sentence in word_urls %}
                            <p>{{ sentence }}</p>
                        {% endfor %}
                    {% else %}
                        <p>ì¶”ì²œ ë¬¸êµ¬ê°€ ì—†ìŠµë‹ˆë‹¤.</p>
                    {% endif %}
                </div>
            </div>
        </div>

        <div class="card-footer">
            
            <div class="center-btn-group">
                {% if image_urls %}
                <a href="{{ image_urls.0 }}" 
                   download="generated_image.png" 
                   id="download-link" 
                   class="btn-download"
                   title="ì´ë¯¸ì§€ ë‹¤ìš´ë¡œë“œ">
                   <span class="icon">â¬‡ï¸</span> ì´ë¯¸ì§€ ë‹¤ìš´ë¡œë“œ
                </a>
                {% endif %}
            </div>

            <div class="right-icon-group">
                <button class="btn-icon" title="íˆìŠ¤í† ë¦¬ (ì¤€ë¹„ ì¤‘)" disabled>
                    <span class="icon-gallery">ğŸ–¼ï¸</span>
                </button>

                <a href="{% url 'main' %}?product_type={{ original_settings.product_type|urlencode }}&theme={{ original_settings.theme|urlencode }}&mood={{ original_settings.mood|urlencode }}&placement={{ original_settings.placement|urlencode }}&prompt={{ original_settings.prompt|urlencode }}&extra_requirements={{ original_settings.extra_requirements|urlencode }}&model={{ original_settings.model|urlencode }}&aspect_ratio={{ original_settings.aspect_ratio|urlencode }}&count={{ original_settings.count|urlencode }}" 
                   class="btn-icon" 
                   title="ì„¤ì • ìœ ì§€í•˜ê³  ëŒì•„ê°€ê¸°">
                    <span class="icon-undo">ğŸ”„</span>
                </a>
            </div>
        </div>

    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', () => {
    const mainImage = document.getElementById('main-image');
    const downloadLink = document.getElementById('download-link');
    const thumbnailContainer = document.getElementById('thumbnail-container'); // ì´ì œ HTMLì— IDê°€ ì¡´ì¬í•¨

    if (thumbnailContainer) {
        thumbnailContainer.addEventListener('click', (e) => {
            // í´ë¦­ëœ ìš”ì†Œê°€ .thumb-item í˜¹ì€ ê·¸ ë‚´ë¶€ ì´ë¯¸ì§€ì¸ì§€ í™•ì¸
            const thumbItem = e.target.closest('.thumb-item');
            
            if (thumbItem) {
                // data-src ì†ì„±ì—ì„œ ì´ë¯¸ì§€ URL ê°€ì ¸ì˜¤ê¸°
                const newSrc = thumbItem.dataset.src;
                
                // 1. í° ì´ë¯¸ì§€ ë³€ê²½
                if(mainImage) mainImage.src = newSrc;
                
                // 2. ë‹¤ìš´ë¡œë“œ ë§í¬ ë³€ê²½
                if(downloadLink) downloadLink.href = newSrc;
                
                // 3. ì¸ë„¤ì¼ í™œì„± ìŠ¤íƒ€ì¼ ë³€ê²½
                const thumbnails = thumbnailContainer.querySelectorAll('.thumb-item');
                thumbnails.forEach(thumb => thumb.classList.remove('active'));
                thumbItem.classList.add('active');
            }
        });
    }
});
</script>
{% endblock %}